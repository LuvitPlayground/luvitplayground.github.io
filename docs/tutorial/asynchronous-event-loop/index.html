<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Luvit.io Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Luvit.io Blog Atom Feed"><title data-react-helmet="true">Enter the Event Loop | Luvit.io</title><meta data-react-helmet="true" property="og:url" content="https://unofficialluvitexperiments.github.io//docs/tutorial/asynchronous-event-loop/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Enter the Event Loop | Luvit.io"><meta data-react-helmet="true" name="description" content="Before we explore `uv`, we should pause a moment and consider the different ways that we can access resources (like files or sockets)."><meta data-react-helmet="true" property="og:description" content="Before we explore `uv`, we should pause a moment and consider the different ways that we can access resources (like files or sockets)."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://unofficialluvitexperiments.github.io//docs/tutorial/asynchronous-event-loop/"><link data-react-helmet="true" rel="alternate" href="https://unofficialluvitexperiments.github.io//docs/tutorial/asynchronous-event-loop/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://unofficialluvitexperiments.github.io//docs/tutorial/asynchronous-event-loop/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6c9767aa.css">
<link rel="preload" href="/assets/js/runtime~main.03c7b273.js" as="script">
<link rel="preload" href="/assets/js/main.36e14895.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/luvit-logo-tiny-white.svg" alt="Luvit Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/luvit-logo-tiny-white.svg" alt="Luvit Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Luvit</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/downloads/">Downloads</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/contributing/">Contributing</a><a class="navbar__item navbar__link" href="/security/">Security</a><a class="navbar__item navbar__link" href="/blog/">News</a></div><div class="navbar__items navbar__items--right"><a href="https://discord.gg/luvit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/luvit/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="menu__list-item"><a class="menu__link" href="/downloads/">Downloads</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Documentation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Table of Contents</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Tutorial</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/getting-started/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/hello-world/">Your First Luvit App</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/tutorial/asynchronous-event-loop/">Enter the Event Loop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/luvit-webserver/">A Non-Blocking Webserver</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/bundles/">Self-Contained Bundles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/packaging/">Packaging Made Easy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial/dependency-management/">Dependency Management and Community Packages</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Concepts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">References</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/security/">Security</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Enter the Event Loop</h1></header><p>Before we explore <code>uv</code>, we should pause a moment and consider the different ways that we can access resources (like files or sockets).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="blocking-and-non-blocking-io"></a>Blocking and Non-Blocking I/O<a class="hash-link" href="#blocking-and-non-blocking-io" title="Direct link to heading">#</a></h2><p>The most straightforward way is to request whatever operation we want to execute, wait until it is done, and then continue with our program. This is called <strong>blocking</strong>, because we cannot continue while tasks are pending, and it&#x27;s very wasteful due to the fact that a lot of the time will be spent waiting. It doesn&#x27;t mean our program is stuck, just that it can&#x27;t proceed with the desired task until later.</p><p><strong>Non-blocking</strong> programs are inherently better at utilizing the time we do have to wait, as we simply continue running our program and eventually will be notified via <a href="https://en.wikipedia.org/wiki/Callback_(computer_programming)" target="_blank" rel="noopener noreferrer">callback functions</a>. Once such a notification has occured, we do what we want to do with the resource we were trying to access. This approach is generally preferable, but has two drawbacks: It introduces some overhead for managing the callbacks, and it complicates the flow of execution, which makes the program code much harder to understand and reason about.</p><p>There&#x27;s quite a bit more to it, though we don&#x27;t really need to study all the details to proceed with this tutorial. You can read more on the <a href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/" target="_blank" rel="noopener noreferrer">NodeJS website</a>. Since <code>libuv</code> was originally written for Node, many of the same concepts are shared between it and Luvit.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-asynchronous-event-loop"></a>The Asynchronous Event Loop<a class="hash-link" href="#the-asynchronous-event-loop" title="Direct link to heading">#</a></h2><p>If you haven&#x27;t guessed it by now, the reason that this is fundamental to understanding Luvit is because <code>libuv</code> is designed to support non-blocking requests, and will execute them asynchronously as part of its <a href="https://en.wikipedia.org/wiki/Event_loop" target="_blank" rel="noopener noreferrer">event loop</a>. You can learn more about how exactly this works from both the <a href="http://docs.libuv.org/en/v1.x/design.html" target="_blank" rel="noopener noreferrer">libuv documentation</a> as well as the <a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/" target="_blank" rel="noopener noreferrer">NodeJS website</a>, but the most important part is that programs written for <code>luvit</code> will be wrapped in such an event loop, which fundamentally changes how code is executed behind the scenes.</p><p>Specifically, once your code has been executed <code>luvit</code> will automatically run the <code>libuv</code> event loop (by calling <code>uv.run()</code> at the end of the script). When this happens, <code>libuv</code> will handle all remaining tasks and then exit, returning control to your program. When writing synchronous code, this doesn&#x27;t change anything as there won&#x27;t be outstanding tasks and the event loop exits immediately, but otherwise the program will continue running while seeming &quot;idle&quot;. This is <em>not</em> a <a href="https://en.wikipedia.org/wiki/Busy_waiting" target="_blank" rel="noopener noreferrer">busy/wait</a>, but rather <a href="https://en.wikipedia.org/wiki/Asynchronous_I/O" target="_blank" rel="noopener noreferrer">Asynchronous I/O</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="examples"></a>Examples<a class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><p>Time for some examples to illustrate these different concepts! Let&#x27;s create a new file containing some arbitrary text:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">HelloWorld.txt</div><div class="codeBlockContent_hGly lua"><pre tabindex="0" class="prism-code language-lua codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Hello from HelloWorld.txt!</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We will now be reading this file both synchronously and asynchronously, using Luvit&#x27;s <code>uv</code> library.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="blocking-io-using-standard-lua"></a>Blocking I/O Using Standard Lua<a class="hash-link" href="#blocking-io-using-standard-lua" title="Direct link to heading">#</a></h3><p>Before doing so, quickly recall how we can read the text file using Lua&#x27;s standard <code>io</code> library:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">ReadFileDemo.lua</div><div class="codeBlockContent_hGly lua"><pre tabindex="0" class="prism-code language-lua codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">local TEXT_FILE_PATH = &quot;HelloWorld.txt&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local file = io.open(TEXT_FILE_PATH, &quot;r&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The file is now OPEN&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local fileContents = file:read(&quot;*all&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;File contents: &quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(fileContents)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">file:close()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The file is now CLOSED&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>These operations are always synchronous and therefore blocking, which makes the code easy to understand. Let&#x27;s try using <code>uv</code> next.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="blocking-io-using-libuv"></a>Blocking I/O Using libuv<a class="hash-link" href="#blocking-io-using-libuv" title="Direct link to heading">#</a></h3><p>To achieve the same result using <code>uv</code>, we have to add some lower-level specifics and call the file system APIs like so:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">ReadFileSyncDemo.lua</div><div class="codeBlockContent_hGly lua"><pre tabindex="0" class="prism-code language-lua codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">local uv = require(&quot;uv&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local TEXT_FILE_PATH = &quot;HelloWorld.txt&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local MODE_READ_WRITE_EXECUTE = 438 -- 0666 as octets</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local file = uv.fs_open(TEXT_FILE_PATH, &quot;r&quot;, MODE_READ_WRITE_EXECUTE)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The file is now OPEN&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local lengthInBytes = string.len(&quot;Hello from HelloWorld.txt!&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local firstByteToRead = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local fileContents = uv.fs_read(file, lengthInBytes, firstByteToRead)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;File contents: &quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(fileContents)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">uv.fs_close(file)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The file is now CLOSED&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This code isn&#x27;t technically equivalent, as <code>libuv</code> does not abstract file system details like the <code>mode</code> or the number of bytes to read. We can safely ignore this, however, at least here in this tutorial. The resulting output is exactly the same and so is the flow of execution:</p><p><img alt="03-blocking-lua-example.png" src="data:image/png;base64,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">
<img alt="03-blocking-uv-example.png" src="data:image/png;base64,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"></p><p>That&#x27;s what one would expect, since we used <em>synchronous</em> I/O to read the file while blocking. But thanks to <code>libuv</code>, we can do better.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="non-blocking-io-using-libuv"></a>Non-Blocking I/O Using libuv<a class="hash-link" href="#non-blocking-io-using-libuv" title="Direct link to heading">#</a></h3><p>As a final demonstration, we will pass callbacks to <code>libuv</code> in order to read the file asynchronously:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">ReadFileAsyncDemo.lua</div><div class="codeBlockContent_hGly lua"><pre tabindex="0" class="prism-code language-lua codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">local uv = require(&quot;uv&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local TEXT_FILE_PATH = &quot;HelloWorld.txt&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local file</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local function onFileClosed()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;Invoking onFileClosed callback&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;The file is now CLOSED&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local function onFileContentsRead(error, fileContents)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;Invoking onFileContentsRead callback&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;File contents: &quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(fileContents)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uv.fs_close(file, onFileClosed)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;The asynchronous CLOSE operation is now queued&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local function onFileOpened(error, fileHandle)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;Invoking onFileOpened callback&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;The file is now OPEN&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    file = fileHandle</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    local lengthInBytes = string.len(&quot;Hello from HelloWorld.txt!&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    local firstByteToRead = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uv.fs_read(file, lengthInBytes, firstByteToRead, onFileContentsRead)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;The asynchronous READ operation is now queued&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">local MODE_READ_WRITE_EXECUTE = 438 -- 0666 as octets</span></span><span class="token-line" style="color:#393A34"><span class="token plain">uv.fs_open(TEXT_FILE_PATH, &quot;r&quot;, MODE_READ_WRITE_EXECUTE, onFileOpened)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The asynchronous OPEN operation is now queued&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;The script has been executed (callbacks are still pending)&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Immediately it is obvious that the flow of execution is significantly more complicated in this example. However, what we can&#x27;t see here is that the program could easily do other tasks while it&#x27;s waiting for the operating system to do the work of reading from disk.</p><p>To better visualize this, a lot of unusually-verbose feedback has been added. The resulting output then is as follows:</p><p><img alt="03-nonblocking-uv-example.png" src="/assets/images/03-nonblocking-uv-example-5ded4fc42981fe0f604a728f95eb1cbd.png"></p><p>The &quot;interleaved&quot; execution flow is a key property of asynchronous code, yielding a high degree of responsiveness in the non-blocking code. This is particularly critical in the domain of servers, where it allows a single process to handle many more requests. An alternative approach that also improves performance is <a href="https://en.wikipedia.org/wiki/Concurrent_computing" target="_blank" rel="noopener noreferrer">multithreading</a>, but this opens an entirely new can of worms by introducing difficult problems - from <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank" rel="noopener noreferrer">race conditions</a> and <a href="https://en.wikipedia.org/wiki/Deadlock" target="_blank" rel="noopener noreferrer">deadlocks</a> to memory consumption and processing overhead - that lead to scalability issues.</p><p>Unfortunately, both of these approaches cause a very significant increase in code complexity, making the flow harder to understand and debug. Lua&#x27;s <a href="https://www.lua.org/pil/9.1.html" target="_blank" rel="noopener noreferrer">coroutines</a> can be used to alleviate the &quot;interleaved execution flow&quot; issue, but this is a more advanced topic best left for another time. Instead, let&#x27;s first see if we can&#x27;t get rid of the low-level complexities that using the <code>uv</code> library introduced.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="luvit-apis-to-the-rescue"></a>Luvit APIs to the Rescue<a class="hash-link" href="#luvit-apis-to-the-rescue" title="Direct link to heading">#</a></h2><p>As we&#x27;ve just seen, the <code>uv</code> library already provides us with all the functionality we need to perform both synchronous and asynchronous tasks. Unfortunately, it&#x27;s a rather low-level interface and requires a significant amount of boilerplate code to do just about anything.</p><p>Since this isn&#x27;t very convenient, Luvit ships with a set of high-level standard libraries that abstract away this functionality and build on it to provide easier-to-use interfaces. Now that we understand what Luvit does underneath the hood, we should make our life a bit easier.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/luvit/luvit.io/edit/master/website/docs/03-documentation/02-tutorial/03-asynchronous-event-loop.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorial/hello-world/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Your First Luvit App</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tutorial/luvit-webserver/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A Non-Blocking Webserver »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#blocking-and-non-blocking-io" class="table-of-contents__link">Blocking and Non-Blocking I/O</a></li><li><a href="#the-asynchronous-event-loop" class="table-of-contents__link">The Asynchronous Event Loop</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a><ul><li><a href="#blocking-io-using-standard-lua" class="table-of-contents__link">Blocking I/O Using Standard Lua</a></li><li><a href="#blocking-io-using-libuv" class="table-of-contents__link">Blocking I/O Using libuv</a></li><li><a href="#non-blocking-io-using-libuv" class="table-of-contents__link">Non-Blocking I/O Using libuv</a></li></ul></li><li><a href="#luvit-apis-to-the-rescue" class="table-of-contents__link">Luvit APIs to the Rescue</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ©2015-2021 The Luvit Authors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.03c7b273.js"></script>
<script src="/assets/js/main.36e14895.js"></script>
</body>
</html>